!function(){"use strict";var e,i,l,s,o,t,u=function(){return(u=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function a(e,s,a,c){return new(a=a||Promise)(function(n,t){function o(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?n(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(o,r)}i((c=c.apply(e,s||[])).next())})}function w(o,r){var i,s,a,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(n){return function(e){var t=[n,e];if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,s&&(a=2&t[0]?s.return:t[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,t[1])).done)return a;switch(s=0,(t=a?[2&t[0],a.value]:t)[0]){case 0:case 1:a=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,s=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(a=0<(a=c.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){c.label=t[1];break}if(6===t[0]&&c.label<a[1]){c.label=a[1],a=t;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(t);break}a[2]&&c.ops.pop(),c.trys.pop();continue}t=r.call(o,c)}catch(e){t=[6,e],s=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}}function d(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(o=i.next()).done;)s.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s}function S(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||((o=o||Array.prototype.slice.call(t,0,r))[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}(n=e=e||{}).ConsentChanged="ConsentChanged",n.ShowConsentNotice="ShowConsentNotice",n.ShowFirstPage="ShowFirstPage",n.CloseConsentNotice="CloseConsentNotice",n.AcceptAll="AcceptAll",n.RejectAll="RejectAll",n.ShowTemplate="ShowTemplate",n.CloseTemplate="CloseTemplate",n.UpdateConsent="UpdateConsent",n.AnchorTagClicked="AnchorTagClicked",n.FetchConfig="FetchConfig",n.QuestionsFormSubmitWithoutMetaData="QuestionsFormSubmitWithoutMetaData",n.QuestionsFormSubmit="QuestionsFormSubmit",n.ShowPreferences="ShowPreferences",n.ConsentPreference="MSFTConsentPreference",(n=i=i||{}).Url="Url",n.Text="Text",(n=l=l||{}).TrackerCategory="trackerCategory",n.Questions="Questions",(s=s||{}).TemplateError="<b>There is something wrong with template. Please check logs.</b>",(n=o=o||{}).WebConsent="WebConsent",n.DSRSubmission="DSRSubmission",(t=t||{}).Preferences="Preferences";var _="webConsent",n=(f.registerShowTemplateHandlers=function(){window.__MSFT_SDK[_].EventBus.on(window.__MSFT_SDK[_].enums.PublicEvents.ShowConsentNotice,f.showFirstPage),window.__MSFT_SDK[_].EventBus.on(window.__MSFT_SDK[_].enums.PublicEvents.CloseConsentNotice,f.hideConsentNotice),window.__MSFT_SDK[_].EventBus.on(window.__MSFT_SDK[_].enums.Events.Init,f.saveStylesOnInit),window.__MSFT_SDK[_].EventBus.on(window.__MSFT_SDK[_].enums.PublicEvents.ShowTemplate,f.showTemplate),window.__MSFT_SDK[_].EventBus.on(window.__MSFT_SDK[_].enums.PublicEvents.CloseTemplate,f.closeTemplate),window.__MSFT_SDK[_].EventBus.on(window.__MSFT_SDK[_].enums.Events.ConfigReady,f.init),window.__MSFT_SDK[_].EventBus.on(window.__MSFT_SDK[_].enums.PublicEvents.ShowPreferences,f.showPreferences)},f.showPreferences=function(){try{f.showTemplate({templateId:t.Preferences})}catch(e){f.showFirstPage()}},f.showTemplate=function(e){e=e.templateId;if(!window.__MSFT_SDK[_].Store.getters.components||!window.__MSFT_SDK[_].Store.getters.components[e])throw new Error("Template : ".concat(e," not found."));var t=window.__MSFT_SDK[_].Store.getters.currentModel;f.showTemplateInIFrame(window.__MSFT_SDK[_].Store.getters.components[e],e,[{type:i.Text,value:(null==(t=null==t?void 0:t.layout.ui.css)?void 0:t[e.toLowerCase()])||""}],f.getParentElement(e))},f.closeTemplate=function(e){e=e.templateId;f.closeIFrame(e)},f.saveStylesOnInit=function(e){e.styles&&(window.__MSFT_SDK[_].Logger.info("user provided styles persisted to window.__MSFT_SDK[kind].Store."),window.__MSFT_SDK[_].Store.reducers.setStyles(e.styles))},f.validationArrayToObject=function(e){return e.reduce(function(e,t){return u(u({},e),((e={})[t.type]=t.value,e))},{})},f.getTemplateData=function(n){return a(this,void 0,void 0,function(){var t,r,i,s,a,c;return w(this,function(e){return t=window.__MSFT_SDK[_].Store.getters.translations,(r={})[l.TrackerCategory]=[],r[l.Questions]=[],i=window.MSFTPrivacy[_].getConsent().preferences,s=new Map,a=new Map,c=new Set,n.kind===o.WebConsent?window.__MSFT_SDK[_].Store.getters.bannerTrackerCategories.forEach(function(e){s.set(e.objectId,e)}):n.kind===o.DSRSubmission&&n.controls.forEach(function(e){e.instances.forEach(function(e){a.set(e.name,e)})}),t.forEach(function(o){return Object.keys(o).forEach(function(e){var t,n;"model"===e?(delete(t=o[e]).trackerCategory,Object.keys(t).forEach(function(e){Array.isArray(t[e])&&t[e].forEach(function(e){var t=a.get(e.name);e.validations=f.validationArrayToObject((null==t?void 0:t.validations)||[])})}),r=u(u({},r),t)):s.has(e)&&!c.has(e)&&(n=u(u({},o[e]),{name:null==(n=s.get(e))?void 0:n.name,isEssential:null==(n=s.get(e))?void 0:n.isEssential,isOn:"1"===i[(null==(n=s.get(e))?void 0:n.name)||""]}),r[l.TrackerCategory].push(n),c.add(e))})}),r[l.TrackerCategory]=S(S([],d(r[l.TrackerCategory].filter(function(e){return e.isEssential})),!1),d(r[l.TrackerCategory].filter(function(e){return!e.isEssential})),!1),r["msft-script-open"]="<script>",r["msft-script-close"]="<\/script>",window.__MSFT_SDK[_].Logger.info("getTemplate data invoked",{consentModel:n,data:r}),[2,u(u(u({},r),window.__MSFT_SDK[_].Store.getters.templateData),{consentModel:n,modelProps:n.properties})]})})},f.init=function(){return a(this,void 0,void 0,function(){var t,n,o;return w(this,function(e){switch(e.label){case 0:return(window.Handlebars&&(window.Handlebars.registerHelper("toLowerCase",function(e){return e.toLowerCase()}),window.Handlebars.registerHelper("equals",function(e,t){return e.toLowerCase()===t.toLowerCase()})),void 0===window.__MSFT_SDK[_].Store.getters.currentModel||void 0===window.__MSFT_SDK[_].Store.getters.template)?(window.__MSFT_SDK[_].Logger.warn("Cannot call init before config is ready."),[2]):(t=window.__MSFT_SDK[_].Store.getters.currentModel,n=window.__MSFT_SDK[_].Store.getters.template,[4,f.getTemplateData(t)]);case 1:return o=e.sent(),n.pages.forEach(function(e){var t;try{var n=window.Handlebars.compile(e.css+e.content)(o)}catch(e){window.__MSFT_SDK[_].Logger.error(e.message,e),n=s.TemplateError}window.__MSFT_SDK[_].Store.reducers.setComponents(u(u({},window.__MSFT_SDK[_].Store.getters.components),((t={})[e.name]=n,t)))}),window.__MSFT_SDK[_].Logger.info("Components updated"),f.initialized=!0,window.__MSFT_SDK[_].EventBus.on(window.__MSFT_SDK[_].enums.PublicEvents.ShowFirstPage,f.showFirstPage),[2]}})})},f.showFirstPage=function(){var r;return a(this,void 0,void 0,function(){var t,n,o;return w(this,function(e){switch(e.label){case 0:return f.initialized?[3,2]:[4,f.init()];case 1:e.sent(),e.label=2;case 2:return void 0===(t=window.__MSFT_SDK[_].Store.getters.currentModel)?(window.__MSFT_SDK[_].Logger.warn("Cannot call init before consent model is selected."),[2]):(n=window.__MSFT_SDK[_].Store.getters.startingLayoutPage,void 0===window.__MSFT_SDK[_].Store.getters.components||void 0===n||void 0===window.__MSFT_SDK[_].Store.getters.components[n]?window.__MSFT_SDK[_].Logger.error("Notice template not found."):(o=window.__MSFT_SDK[_].Store.getters.components[n],f.showTemplateInIFrame(o,n,[{type:i.Text,value:(null==(r=t.layout.ui.css)?void 0:r[n.toLowerCase()])||""}],f.getParentElement(n))),[2])}})})},f.getParentElement=function(e){var t=((null==(t=window.__MSFT_SDK[_].Store.getters.config.initConfig)?void 0:t.componentParentMap)||window.__MSFT_SDK[_].Store.getters.templateParentMap)[e];return t?document.getElementById(t):null},f.showTemplateInIFrame=function(e,t,n,o){var r;void 0===n&&(n=[]),document.getElementById(t)?window.__MSFT_SDK[_].Logger.info("Template: ".concat(t," is already open.")):(e!==s.TemplateError||window.__MSFT_SDK[_].Store.getters.isLivePreviewMode&&window.__MSFT_SDK[_].Store.getters.isPreviewMode)&&(r={origin:window.origin,renderTemplateWithoutIframe:null==(r=window.__MSFT_SDK[_].Store.getters.config.initConfig)?void 0:r.renderTemplateWithoutIframe,executionContexts:(null==(r=window.__MSFT_SDK[_].Store.getters.config.initConfig)?void 0:r.executionContexts)||[]},e="<script>var msftData = ".concat(JSON.stringify(r),"<\/script>\n        <script>").concat(window.__MSFT_SDK[_].Store.getters.proxyJS,"<\/script>")+e,window.__MSFT_SDK[_].Utils.IFrameUtils.createIFrame(e,t,o,n))},f.hideConsentNotice=function(){var e;void 0===window.__MSFT_SDK[_].Store.getters.currentModel?window.__MSFT_SDK[_].Logger.warn("Cannot call hideConsentNotice before consent model is selected."):(e=window.__MSFT_SDK[_].Store.getters.startingLayoutPage)&&f.closeIFrame(e)},f.closeIFrame=function(e){var t,e=document.getElementById(e);null!=(t=null==e?void 0:e.parentElement)&&t.removeChild(e)},f.initialized=!1,f);function f(){f.registerShowTemplateHandlers()}window.onmessage=function(o){return a(void 0,void 0,void 0,function(){var t,n;return w(this,function(e){switch(e.label){case 0:return"null"!==o.origin?[3,3]:window.__MSFT_SDK[_].Store.getters.isActionDisabled&&"trigger"===o.data.method?[2]:(t=(t=window.MSFTPrivacy[_])[o.data.method].apply(t,S([],d(o.data.params),!1)))instanceof Promise?[4,t]:[3,2];case 1:t=e.sent(),e.label=2;case 2:o.data.responseId&&null!=(n=o.source)&&n.postMessage(u(u({},o.data),{response:t}),{targetOrigin:"*"}),e.label=3;case 3:return[2]}})})},window.__MSFT_SDK[_].EventBus.on(e.AnchorTagClicked,function(e){var t=e.attributes,n=document.createElement("a");Object.keys(t).forEach(function(e){n.setAttribute(e,t[e])}),n.click()}),new n}();
