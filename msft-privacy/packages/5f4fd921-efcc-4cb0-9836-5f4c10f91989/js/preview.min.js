(function () {
    'use strict';

    var ListenerEvents;
    (function (ListenerEvents) {
        ListenerEvents["INIT_CONFIG"] = "initConfig";
        ListenerEvents["DISCONNECT"] = "disconnect";
    })(ListenerEvents || (ListenerEvents = {}));
    var DispatcherEvents;
    (function (DispatcherEvents) {
        DispatcherEvents["CONNECTED"] = "connected";
        DispatcherEvents["CLOSED"] = "closed";
    })(DispatcherEvents || (DispatcherEvents = {}));

    var PostMessage = /** @class */ (function () {
        function PostMessage(callback) {
            this.source = null;
            this.origin = '';
            // https://privacy.ci.ext.web.purview.azure-test.com
            // https://privacy.canary.ext.web.purview.azure.com
            // https://privacy.ms.ext.web.purview.azure.com
            this.regExp = new RegExp('^https://privacy.(ci|ms|canary).ext.web.purview.azure(-test){0,1}.com$');
            this.callback = callback;
            this.listen();
        }
        PostMessage.prototype.send = function (details) {
            var _a;
            (_a = this.source) === null || _a === void 0 ? void 0 : _a.postMessage(details, { targetOrigin: this.origin });
        };
        PostMessage.prototype.onMessageReceived = function (event) {
            if (this.regExp.test(event.origin)) {
                this.source = this.source || event.source;
                this.origin = this.origin || event.origin;
                this.callback(event.data);
            }
            else {
                window.__MSFT_SDK.Logger.warn("Received invalid origin '".concat(event.origin, "'. Skipping execution."));
            }
        };
        PostMessage.prototype.listen = function () {
            var _this = this;
            window.addEventListener('message', function (event) {
                _this.onMessageReceived(event);
            });
        };
        return PostMessage;
    }());

    var Messenger = /** @class */ (function () {
        function Messenger() {
        }
        Messenger.send = function (payload) {
            Messenger.messengerPlugin.send(payload);
        };
        Messenger.listen = function (eventName, callback) {
            Messenger.callbacksMap[eventName] = Messenger.callbacksMap[eventName] || [];
            Messenger.callbacksMap[eventName].push(callback);
        };
        Messenger.getMessengerPlugin = function () {
            return Messenger.messengerPlugin;
        };
        Messenger.onMessage = function (_a) {
            var _b;
            var event = _a.event, value = _a.value;
            (_b = Messenger.callbacksMap[event]) === null || _b === void 0 ? void 0 : _b.forEach(function (callback) { return callback(value); });
        };
        Messenger.callbacksMap = {};
        Messenger.messengerPlugin = new PostMessage(Messenger.onMessage);
        return Messenger;
    }());

    var _a$1;
    var dispatcher = (_a$1 = {},
        _a$1[DispatcherEvents.CONNECTED] = function () {
            Messenger.send({
                event: DispatcherEvents.CONNECTED,
            });
        },
        _a$1[DispatcherEvents.CLOSED] = function () {
            Messenger.send({ event: DispatcherEvents.CLOSED });
        },
        _a$1);

    var _a;
    var listeners = (_a = {},
        _a[ListenerEvents.INIT_CONFIG] = function (initConfig) {
            window.__MSFT_SDK.initConsent(initConfig);
            dispatcher.connected();
        },
        _a[ListenerEvents.DISCONNECT] = function () {
            window.close();
        },
        _a);
    Object.keys(listeners).forEach(function (event) {
        Messenger.listen(event, listeners[event]);
    });

    var unload = function () {
        dispatcher.closed();
    };
    window.addEventListener('beforeunload', unload, false);

}());
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJldmlldy5taW4uanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL1NESy9zcmMvcHJldmlldy9lbnVtcy9FdmVudHNFbnVtLnRzIiwiLi4vLi4vLi4vLi4vLi4vU0RLL3NyYy9wcmV2aWV3L3BsdWdpbnMvUG9zdE1lc3NhZ2UudHMiLCIuLi8uLi8uLi8uLi8uLi9TREsvc3JjL3ByZXZpZXcvTWVzc2VuZ2VyLnRzIiwiLi4vLi4vLi4vLi4vLi4vU0RLL3NyYy9wcmV2aWV3L0Rpc3BhdGNoZXJzLnRzIiwiLi4vLi4vLi4vLi4vLi4vU0RLL3NyYy9wcmV2aWV3L0xpc3RlbmVycy50cyIsIi4uLy4uLy4uLy4uLy4uL1NESy9zcmMvcHJldmlldy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZW51bSBMaXN0ZW5lckV2ZW50cyB7XHJcbiAgSU5JVF9DT05GSUcgPSAnaW5pdENvbmZpZycsXHJcbiAgRElTQ09OTkVDVCA9ICdkaXNjb25uZWN0JyxcclxufVxyXG5cclxuZXhwb3J0IGVudW0gRGlzcGF0Y2hlckV2ZW50cyB7XHJcbiAgQ09OTkVDVEVEID0gJ2Nvbm5lY3RlZCcsXHJcbiAgQ0xPU0VEID0gJ2Nsb3NlZCcsXHJcbn1cclxuIiwiaW1wb3J0IHsgSUludGVybmFsTWVzc2VuZ2VyQ2FsbGJhY2sgfSBmcm9tICcuLi9pbnRlcmZhY2UvSU1lc3Nlbmdlcic7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3N0TWVzc2FnZSB7XHJcbiAgcHJpdmF0ZSBzb3VyY2U6IE1lc3NhZ2VFdmVudFNvdXJjZSB8IG51bGwgPSBudWxsO1xyXG4gIHByaXZhdGUgb3JpZ2luID0gJyc7XHJcblxyXG4gIC8vIGh0dHBzOi8vcHJpdmFjeS5jaS5leHQud2ViLnB1cnZpZXcuYXp1cmUtdGVzdC5jb21cclxuICAvLyBodHRwczovL3ByaXZhY3kuY2FuYXJ5LmV4dC53ZWIucHVydmlldy5henVyZS5jb21cclxuICAvLyBodHRwczovL3ByaXZhY3kubXMuZXh0LndlYi5wdXJ2aWV3LmF6dXJlLmNvbVxyXG4gIHByaXZhdGUgcmVnRXhwID0gbmV3IFJlZ0V4cChcclxuICAgICdeaHR0cHM6Ly9wcml2YWN5LihjaXxtc3xjYW5hcnkpLmV4dC53ZWIucHVydmlldy5henVyZSgtdGVzdCl7MCwxfS5jb20kJyxcclxuICApO1xyXG4gIHByaXZhdGUgY2FsbGJhY2s6IElJbnRlcm5hbE1lc3NlbmdlckNhbGxiYWNrO1xyXG5cclxuICBjb25zdHJ1Y3RvcihjYWxsYmFjazogSUludGVybmFsTWVzc2VuZ2VyQ2FsbGJhY2spIHtcclxuICAgIHRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjaztcclxuICAgIHRoaXMubGlzdGVuKCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2VuZChkZXRhaWxzOiBhbnkpIHtcclxuICAgIHRoaXMuc291cmNlPy5wb3N0TWVzc2FnZShkZXRhaWxzLCB7IHRhcmdldE9yaWdpbjogdGhpcy5vcmlnaW4gfSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgb25NZXNzYWdlUmVjZWl2ZWQoZXZlbnQ6IGFueSkge1xyXG4gICAgaWYgKHRoaXMucmVnRXhwLnRlc3QoZXZlbnQub3JpZ2luKSkge1xyXG4gICAgICB0aGlzLnNvdXJjZSA9IHRoaXMuc291cmNlIHx8IGV2ZW50LnNvdXJjZTtcclxuICAgICAgdGhpcy5vcmlnaW4gPSB0aGlzLm9yaWdpbiB8fCBldmVudC5vcmlnaW47XHJcbiAgICAgIHRoaXMuY2FsbGJhY2soZXZlbnQuZGF0YSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB3aW5kb3cuX19NU0ZUX1NESy5Mb2dnZXIud2FybihcclxuICAgICAgICBgUmVjZWl2ZWQgaW52YWxpZCBvcmlnaW4gJyR7ZXZlbnQub3JpZ2lufScuIFNraXBwaW5nIGV4ZWN1dGlvbi5gLFxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBsaXN0ZW4oKSB7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGV2ZW50ID0+IHtcclxuICAgICAgdGhpcy5vbk1lc3NhZ2VSZWNlaXZlZChldmVudCk7XHJcbiAgICB9KTtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgTGlzdGVuZXJFdmVudHMgfSBmcm9tICcuL2VudW1zL0V2ZW50c0VudW0nO1xyXG5pbXBvcnQge1xyXG4gIElDYWxsYmFja3NNYXAsXHJcbiAgSUxpc3RlbmVyQ2FsbGJhY2ssXHJcbiAgSUludGVybmFsTWVzc2VuZ2VyQ2FsbGJhY2tEYXRhLFxyXG59IGZyb20gJy4vaW50ZXJmYWNlL0lNZXNzZW5nZXInO1xyXG5pbXBvcnQgUG9zdE1lc3NhZ2UgZnJvbSAnLi9wbHVnaW5zL1Bvc3RNZXNzYWdlJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1lc3NlbmdlciB7XHJcbiAgc3RhdGljIGNhbGxiYWNrc01hcDogSUNhbGxiYWNrc01hcCA9IHt9O1xyXG4gIHN0YXRpYyBtZXNzZW5nZXJQbHVnaW4gPSBuZXcgUG9zdE1lc3NhZ2UoTWVzc2VuZ2VyLm9uTWVzc2FnZSk7XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgc2VuZChwYXlsb2FkOiBJSW50ZXJuYWxNZXNzZW5nZXJDYWxsYmFja0RhdGEpIHtcclxuICAgIE1lc3Nlbmdlci5tZXNzZW5nZXJQbHVnaW4uc2VuZChwYXlsb2FkKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgbGlzdGVuKGV2ZW50TmFtZTogTGlzdGVuZXJFdmVudHMsIGNhbGxiYWNrOiBJTGlzdGVuZXJDYWxsYmFjaykge1xyXG4gICAgTWVzc2VuZ2VyLmNhbGxiYWNrc01hcFtldmVudE5hbWVdID0gTWVzc2VuZ2VyLmNhbGxiYWNrc01hcFtldmVudE5hbWVdIHx8IFtdO1xyXG4gICAgTWVzc2VuZ2VyLmNhbGxiYWNrc01hcFtldmVudE5hbWVdLnB1c2goY2FsbGJhY2spO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0YXRpYyBnZXRNZXNzZW5nZXJQbHVnaW4oKSB7XHJcbiAgICByZXR1cm4gTWVzc2VuZ2VyLm1lc3NlbmdlclBsdWdpbjtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3RhdGljIG9uTWVzc2FnZSh7IGV2ZW50LCB2YWx1ZSB9OiBJSW50ZXJuYWxNZXNzZW5nZXJDYWxsYmFja0RhdGEpIHtcclxuICAgIE1lc3Nlbmdlci5jYWxsYmFja3NNYXBbZXZlbnRdPy5mb3JFYWNoKGNhbGxiYWNrID0+IGNhbGxiYWNrKHZhbHVlKSk7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCB7IERpc3BhdGNoZXJFdmVudHMgfSBmcm9tICcuL2VudW1zL0V2ZW50c0VudW0nO1xyXG5pbXBvcnQgTWVzc2VuZ2VyIGZyb20gJy4vTWVzc2VuZ2VyJztcclxuXHJcbnR5cGUgSURpc3BhdGNoZXJzID0ge1xyXG4gIFtldmVudE5hbWUgaW4gRGlzcGF0Y2hlckV2ZW50c106ICgpID0+IHZvaWQ7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZGlzcGF0Y2hlcjogSURpc3BhdGNoZXJzID0ge1xyXG4gIFtEaXNwYXRjaGVyRXZlbnRzLkNPTk5FQ1RFRF06ICgpID0+IHtcclxuICAgIE1lc3Nlbmdlci5zZW5kKHtcclxuICAgICAgZXZlbnQ6IERpc3BhdGNoZXJFdmVudHMuQ09OTkVDVEVELFxyXG4gICAgfSk7XHJcbiAgfSxcclxuICBbRGlzcGF0Y2hlckV2ZW50cy5DTE9TRURdOiAoKSA9PiB7XHJcbiAgICBNZXNzZW5nZXIuc2VuZCh7IGV2ZW50OiBEaXNwYXRjaGVyRXZlbnRzLkNMT1NFRCB9KTtcclxuICB9LFxyXG59O1xyXG4iLCJpbXBvcnQgeyBkaXNwYXRjaGVyIH0gZnJvbSAnLi9EaXNwYXRjaGVycyc7XHJcbmltcG9ydCB7IExpc3RlbmVyRXZlbnRzIH0gZnJvbSAnLi9lbnVtcy9FdmVudHNFbnVtJztcclxuaW1wb3J0IHsgSUxpc3RlbmVyQ2FsbGJhY2sgfSBmcm9tICcuL2ludGVyZmFjZS9JTWVzc2VuZ2VyJztcclxuaW1wb3J0IE1lc3NlbmdlciBmcm9tICcuL01lc3Nlbmdlcic7XHJcblxyXG50eXBlIElMaXN0ZW5lcnMgPSB7XHJcbiAgW2V2ZW50TmFtZSBpbiBMaXN0ZW5lckV2ZW50c106IElMaXN0ZW5lckNhbGxiYWNrO1xyXG59O1xyXG5cclxuY29uc3QgbGlzdGVuZXJzOiBJTGlzdGVuZXJzID0ge1xyXG4gIFtMaXN0ZW5lckV2ZW50cy5JTklUX0NPTkZJR106IChpbml0Q29uZmlnOiBJSW5pdENvbmZpZykgPT4ge1xyXG4gICAgd2luZG93Ll9fTVNGVF9TREsuaW5pdENvbnNlbnQoaW5pdENvbmZpZyk7XHJcbiAgICBkaXNwYXRjaGVyLmNvbm5lY3RlZCgpO1xyXG4gIH0sXHJcbiAgW0xpc3RlbmVyRXZlbnRzLkRJU0NPTk5FQ1RdOiAoKSA9PiB7XHJcbiAgICB3aW5kb3cuY2xvc2UoKTtcclxuICB9LFxyXG59O1xyXG5cclxuKE9iamVjdC5rZXlzKGxpc3RlbmVycykgYXMgTGlzdGVuZXJFdmVudHNbXSkuZm9yRWFjaChldmVudCA9PiB7XHJcbiAgTWVzc2VuZ2VyLmxpc3RlbihldmVudCwgbGlzdGVuZXJzW2V2ZW50XSk7XHJcbn0pO1xyXG4iLCJpbXBvcnQgeyBkaXNwYXRjaGVyIH0gZnJvbSAnLi9EaXNwYXRjaGVycyc7XHJcbmltcG9ydCAnLi9MaXN0ZW5lcnMnO1xyXG5cclxuY29uc3QgdW5sb2FkID0gKCkgPT4ge1xyXG4gIGRpc3BhdGNoZXIuY2xvc2VkKCk7XHJcbn07XHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCB1bmxvYWQsIGZhbHNlKTtcclxuIl0sIm5hbWVzIjpbIl9hIl0sIm1hcHBpbmdzIjoiOzs7SUFBQSxJQUFZLGNBR1g7SUFIRCxXQUFZLGNBQWM7UUFDeEIsNENBQTBCLENBQUE7UUFDMUIsMkNBQXlCLENBQUE7SUFDM0IsQ0FBQyxFQUhXLGNBQWMsS0FBZCxjQUFjLFFBR3pCO0lBRUQsSUFBWSxnQkFHWDtJQUhELFdBQVksZ0JBQWdCO1FBQzFCLDJDQUF1QixDQUFBO1FBQ3ZCLHFDQUFpQixDQUFBO0lBQ25CLENBQUMsRUFIVyxnQkFBZ0IsS0FBaEIsZ0JBQWdCOztJQ0g1QjtRQVlFLHFCQUFZLFFBQW9DO1lBWHhDLFdBQU0sR0FBOEIsSUFBSSxDQUFDO1lBQ3pDLFdBQU0sR0FBRyxFQUFFLENBQUM7Ozs7WUFLWixXQUFNLEdBQUcsSUFBSSxNQUFNLENBQ3pCLHdFQUF3RSxDQUN6RSxDQUFDO1lBSUEsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7WUFDekIsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1NBQ2Y7UUFFTSwwQkFBSSxHQUFYLFVBQVksT0FBWTs7WUFDdEIsTUFBQSxJQUFJLENBQUMsTUFBTSwwQ0FBRSxXQUFXLENBQUMsT0FBTyxFQUFFLEVBQUUsWUFBWSxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1NBQ2xFO1FBRU0sdUNBQWlCLEdBQXhCLFVBQXlCLEtBQVU7WUFDakMsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUU7Z0JBQ2xDLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDO2dCQUMxQyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLElBQUksS0FBSyxDQUFDLE1BQU0sQ0FBQztnQkFDMUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDM0I7aUJBQU07Z0JBQ0wsTUFBTSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUMzQixtQ0FBNEIsS0FBSyxDQUFDLE1BQU0sMkJBQXdCLENBQ2pFLENBQUM7YUFDSDtTQUNGO1FBRU8sNEJBQU0sR0FBZDtZQUFBLGlCQUlDO1lBSEMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxVQUFBLEtBQUs7Z0JBQ3RDLEtBQUksQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUMvQixDQUFDLENBQUM7U0FDSjtRQUNILGtCQUFDO0lBQUQsQ0FBQzs7SUNoQ0Q7UUFBQTtTQW9CQztRQWhCZSxjQUFJLEdBQWxCLFVBQW1CLE9BQXVDO1lBQ3hELFNBQVMsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1NBQ3pDO1FBRWEsZ0JBQU0sR0FBcEIsVUFBcUIsU0FBeUIsRUFBRSxRQUEyQjtZQUN6RSxTQUFTLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxDQUFDO1lBQzVFLFNBQVMsQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQ2xEO1FBRWEsNEJBQWtCLEdBQWhDO1lBQ0UsT0FBTyxTQUFTLENBQUMsZUFBZSxDQUFDO1NBQ2xDO1FBRWMsbUJBQVMsR0FBeEIsVUFBeUIsRUFBZ0Q7O2dCQUE5QyxLQUFLLFdBQUEsRUFBRSxLQUFLLFdBQUE7WUFDckMsTUFBQSxTQUFTLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQywwQ0FBRSxPQUFPLENBQUMsVUFBQSxRQUFRLElBQUksT0FBQSxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUEsQ0FBQyxDQUFDO1NBQ3JFO1FBbEJNLHNCQUFZLEdBQWtCLEVBQUUsQ0FBQztRQUNqQyx5QkFBZSxHQUFHLElBQUksV0FBVyxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQWtCaEUsZ0JBQUM7S0FwQkQ7OztJQ0RPLElBQU0sVUFBVTtRQUNyQkEsS0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLElBQUc7WUFDNUIsU0FBUyxDQUFDLElBQUksQ0FBQztnQkFDYixLQUFLLEVBQUUsZ0JBQWdCLENBQUMsU0FBUzthQUNsQyxDQUFDLENBQUM7U0FDSjtRQUNEQSxLQUFDLGdCQUFnQixDQUFDLE1BQU0sSUFBRztZQUN6QixTQUFTLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLGdCQUFnQixDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7U0FDcEQ7YUFDRjs7O0lDUEQsSUFBTSxTQUFTO1FBQ2IsR0FBQyxjQUFjLENBQUMsV0FBVyxJQUFHLFVBQUMsVUFBdUI7WUFDcEQsTUFBTSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDMUMsVUFBVSxDQUFDLFNBQVMsRUFBRSxDQUFDO1NBQ3hCO1FBQ0QsR0FBQyxjQUFjLENBQUMsVUFBVSxJQUFHO1lBQzNCLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztTQUNoQjtXQUNGLENBQUM7SUFFRCxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBc0IsQ0FBQyxPQUFPLENBQUMsVUFBQSxLQUFLO1FBQ3hELFNBQVMsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQzVDLENBQUMsQ0FBQzs7SUNsQkYsSUFBTSxNQUFNLEdBQUc7UUFDYixVQUFVLENBQUMsTUFBTSxFQUFFLENBQUM7SUFDdEIsQ0FBQyxDQUFDO0lBQ0YsTUFBTSxDQUFDLGdCQUFnQixDQUFDLGNBQWMsRUFBRSxNQUFNLEVBQUUsS0FBSyxDQUFDOzs7Ozs7In0=
