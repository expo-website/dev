!function(){var n,c="trackerConsent",S=((r=n=n||{}).OFF="0",r.ON="1",e.shouldBlockTrackerSource=function(e){return Boolean(null==e?void 0:e.split(",").some(function(t){var e=window.__MSFT_SDK[c].Store.getters.applicablePurposes.find(function(e){return e.name===t});return e?!0!==(null==(e=e.properties)?void 0:e.isEssential):null==(e=null==(e=null==(e=window.__MSFT_SDK[c].Store.getters.sdkConfig)?void 0:e.properties)?void 0:e.trackerBlocking)?void 0:e.isUnknownTagBlockingEnabled}))},e.shouldUnblockTrackerSource=function(e){return Boolean(null==e?void 0:e.split(",").every(function(e){var t;return(null==(t=window.__MSFT_SDK[c].Store.getters.userConsent)?void 0:t.preferences[e])===n.ON}))},e.SCRIPT_BLOCKING_TYPE_ATTRIBUTE_VALUE="text/blocked",e.MSFT_CONSENT_PURPOSES_ATTRIBUTE="msft-consent-purposes",e.MSFT_TRACKER_EXECUTION_ATTRIBUTE="msft-tracker-executed",e.SRC_ATTRIBUTE="src",e.DATASET_SRC_ATTRIBUTE="data-src",e.SCRIPT_TYPE_ATTRIBUTE="type",e.MSFT_POST_CONSENT_SCRIPT_TYPE_ATTRIBUTE="msft-post-consent-type",e.MSFT_CONSENT_IGNORE_ATTRIBUTE="msft-ignore-consent",e);function e(){}function o(){this.domObserver=null}o.mutationCallback=function(e){e.forEach(function(e){e.addedNodes.forEach(function(t){try{1===t.nodeType&&!1===t.hasAttribute(S.MSFT_CONSENT_IGNORE_ATTRIBUTE)&&(t.nodeName.toLowerCase()===window.__MSFT_SDK[c].enums.RegisteredDivType.Script?o.scriptMutationObserver(t):t.nodeName.toLowerCase()===window.__MSFT_SDK[c].enums.RegisteredDivType.IFrame&&o.iframeMutationObserver(t))}catch(e){console.warn("Failed to block the node ",t.nodeName,"with error ",e),window.__MSFT_SDK[c].Logger.warn("Failed to block tag "+t.nodeName)}})})},o.scriptMutationObserver=function(t){function n(e){t.getAttribute(S.SCRIPT_TYPE_ATTRIBUTE)===S.SCRIPT_BLOCKING_TYPE_ATTRIBUTE_VALUE&&e.preventDefault(),t.removeEventListener("beforescriptexecute",n)}var e=t.type,o=t.getAttribute(S.MSFT_CONSENT_PURPOSES_ATTRIBUTE);S.shouldBlockTrackerSource(o)&&(window.__MSFT_SDK[c].Logger.info("Blocking script "+t.src),t.hasAttribute(S.MSFT_TRACKER_EXECUTION_ATTRIBUTE)||(t.setAttribute(S.MSFT_POST_CONSENT_SCRIPT_TYPE_ATTRIBUTE,e),t.setAttribute(S.SCRIPT_TYPE_ATTRIBUTE,S.SCRIPT_BLOCKING_TYPE_ATTRIBUTE_VALUE)));t.addEventListener("beforescriptexecute",n)},o.iframeMutationObserver=function(e){var t=e.src,n=e.getAttribute(S.MSFT_CONSENT_PURPOSES_ATTRIBUTE);S.shouldBlockTrackerSource(n)&&(window.__MSFT_SDK[c].Logger.info("Blocking iframe "+e.src),e.removeAttribute(S.SRC_ATTRIBUTE),e.setAttribute(S.DATASET_SRC_ATTRIBUTE,t))},o.unblock=function(){window.__MSFT_SDK[c].Logger.info("Tracker Blocking unblock is started"),o.unblockScripts(),o.unblockIFrames()},o.unblockScripts=function(){document.querySelectorAll("script[".concat(S.MSFT_CONSENT_PURPOSES_ATTRIBUTE,"][").concat(S.SCRIPT_TYPE_ATTRIBUTE,'="').concat(S.SCRIPT_BLOCKING_TYPE_ATTRIBUTE_VALUE,'"]:not([').concat(S.MSFT_CONSENT_PURPOSES_ATTRIBUTE,'=""])')).forEach(function(e){var t=e;try{var n=t.getAttribute(S.MSFT_CONSENT_PURPOSES_ATTRIBUTE);if(S.shouldUnblockTrackerSource(n)){window.__MSFT_SDK[c].Logger.info("Unblocking script "+t.src);for(var o=null!=(o=t.getAttribute(S.MSFT_POST_CONSENT_SCRIPT_TYPE_ATTRIBUTE))?o:"application/javascript",T=t.parentNode,r=(null!=T&&T.removeChild(t),document.createElement("script")),i=0;i<t.attributes.length;i++){var _=t.attributes[i];"type"!==_.name?r.setAttribute(_.name,t.attributes[i].value):r.setAttribute(S.SCRIPT_TYPE_ATTRIBUTE,o)}r.setAttribute(S.MSFT_TRACKER_EXECUTION_ATTRIBUTE,"true"),r.appendChild(document.createTextNode(t.innerHTML)),(null==T?document.head:T).appendChild(r)}else window.__MSFT_SDK[c].Logger.info("Not Unblocking script ".concat(t.src," as consent not given"))}catch(e){window.__MSFT_SDK[c].Logger.info("Failed to unblock script ".concat(t.src))}})},o.unblockIFrames=function(){document.querySelectorAll("iframe[".concat(S.MSFT_CONSENT_PURPOSES_ATTRIBUTE,"][").concat(S.DATASET_SRC_ATTRIBUTE,"]:not([").concat(S.MSFT_CONSENT_PURPOSES_ATTRIBUTE,'=""][').concat(S.DATASET_SRC_ATTRIBUTE,'=""])')).forEach(function(t){try{var e,n,o,T=t.getAttribute(S.MSFT_CONSENT_PURPOSES_ATTRIBUTE);S.shouldUnblockTrackerSource(T)?(window.__MSFT_SDK[c].Logger.info("Unblocking iframe "+t.src),null!=(e=t.parentNode)&&e.removeChild(t),o=null!==(o=(n=t.cloneNode(!0)).getAttribute(S.DATASET_SRC_ATTRIBUTE))?o:"",n.setAttribute(S.SRC_ATTRIBUTE,o),n.setAttribute(S.MSFT_TRACKER_EXECUTION_ATTRIBUTE,"true"),n.removeAttribute(S.DATASET_SRC_ATTRIBUTE),(null==e?document.head:e).appendChild(n)):window.__MSFT_SDK[c].Logger.info("Not Unblocking iframe ".concat(t.src," as consent not given"))}catch(e){window.__MSFT_SDK[c].Logger.info("Failed to unblock iframe ".concat(t.src))}})},o.prototype.start=function(e){window.__MSFT_SDK[c].EventBus.on(window.__MSFT_SDK[c].enums.PublicEvents.ConsentChanged,o.unblock),this.domObserver=null,e&&(this.domObserver=new MutationObserver(function(e){return o.mutationCallback(e)}),this.domObserver.observe(document.documentElement,{childList:!0,subtree:!0}),window.__MSFT_SDK[c].Logger.info("Started tracker blocking service"))};var t,T=new o,r=(i.getBlockingService=function(){return T},i);function i(){}window.__MSFT_SDK[c].Helpers.addPublicApis(r),window.__MSFT_SDK[c].Helpers.exposeApis(),null!=(t=null==(t=null==(t=null==(t=window.__MSFT_SDK[c].Store.getters.sdkConfig)?void 0:t.properties)?void 0:t.trackerBlocking)?void 0:t.isEnabled)&&!t||r.getBlockingService().start(!0)}();
